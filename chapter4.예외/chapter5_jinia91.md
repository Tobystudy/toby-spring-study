# 자바의 예외 기본 구조

![image](https://github.com/Tobystudy/toby-spring-study/assets/85499582/53603739-af2d-474b-83a1-81d78c21c12c)

- 기본 철학은 checked 예외는 예측가능하므로 (논리적인 의미의)예외 처리를 하라는 소리!
- unchecked ex는 예상치 못한 예외일 가능성이 높으므로 예외 처리를 해도 되고 안해도 된다.

# Checked EX 논쟁

- https://velog.io/@eastperson/Java%EC%9D%98-Checked-Exception%EC%9D%80-%EC%8B%A4%EC%88%98%EB%8B%A4-83omm70j
- 위의 아티클이 매우 정리가 잘되있음


- 단순히 결론만 이야기하자면

## Checked Ex의 문제점들

1. 실제론 핸들링이 불가능한 경우가 많다 - 복구 불가능한 예외들...
2. 결국 생산성 저하와 가독성 저하만 만드는경우가 많다
3. 실제로 기능하지 않는 수천개의 try catch ex 블록이 필요해진다

> 결론 : checked Ex는 불필요하다

## 코틀린은 Checked Ex가 없다.

- 위의 논의들을 통해 코틀린은 언어차원에서 Checked Ex를 없애버림
- 모든 예외는 Unchecked

## 비지니스 제어에 대한 예외 방식의 정의와 핸들링 문제

### 비즈니스 제어의 예외 정의는 옳은가?

- 유의미한 정의로 래핑하고 개발자에게 특정 행위를 유도할 수 있다는 점에서 유의미
- 근본적으로 Go-To 문이라는 점에서 오히려 제어의 흐름 복잡성과 가독성을 저해한다는 의견도 존재
- 하지만 안쓰면 모든 응답을 0 /1 이나 에러코드, Result등으로 감싸고 외부에서 핸들링할것인가?
- 현실적으로 예외를 통한 흐름제어는 나쁘지 않다고 봄

#### 문제는 Checked

- 비즈니스 예외의경우 토프링에서도 말하는것처럼 Checked가 더 바람직하다.
- 개발자가 해당 api의 핸들링 의도를 명시적으로 알수 있게되기때문
- 코틀린은 checked가 없어서 컴파일레벨에서 예외를 통한 제어 의도를 알기 쉽지 않다...
  - 개인적으로 checked 기능이 존재함에도, 완전히 제거한건 언어적인 설계 결함이라고 생각함
 
## 예외처리

### 나쁜 예외처리
- 단순 소거처리
- 단순 로깅처리
- 단순 강제종료
- 단순 throw Exception
  - 너무 추상화하여 표현해서 무엇이 전달되는지도 알 수 없고 예외처리 책임을 회피하는 판단일 뿐

### 그럼 어떻게 해야할까?

1. 예외 복구

다른 작업을 하도록 유도.
서버레벨에서는 클라이언트가 이해할수 있는 에러코드등으로 전달하여 다른 동작흐름을 유도할 수 있다.
일반적으로 가장 흔한 방식

- 여기서도 결국 같은 문제가 발생하는데, 해당 api가 발생시키는 의미있는 예외들(에러코드들)이 checked 되어 클라이언트에게 전달되어야한다.
- 문제는 코틀린의경우 서버개발자가 서버레벨에서 발생하는 비지니스에 유의미한 예외들을 명시적으로 다 파악하기가 어려워졌다는것
- 문서화뿐일까...?


2. 예외처리 회피

현재 레이어에서 예외처리를 하는게 바람직하지 않을경우가 존재.
이럴떄는 단순 전달을 할수있음

3. 예외 전환 / 래핑

2번보단 훨씬 바람직한 방법으로 의존성 방향을 고려해 본인 혹은 사용자가 예외를 래핑하여 좀더 추상화되고 상위 레이어에 유의미한 예외로 변경하는것

- 모듈관점에선 모듈경계간 예외 전파 전략의 정의로 볼 수 있음


## 스프링의 예외처리전략

### Checked는 핸들링 없이 그대로 최상위까지 전파하고 Unchecked는 핸들링

- checked Ex의경우 트랜잭션 롤백도 되지 않는다!
- 스프링은 checked는 명시적으로 개발자가 핸들링후 복원을 하던지, unchecked로 변환하길 기대하며 만약 그대로 상위까지 전파시 문제가 될 수 있음

### DB관련 예외들

<img width="628" alt="image" src="https://github.com/Tobystudy/toby-spring-study/assets/85499582/48fe2e39-40d6-48f2-980e-40874eeffa49">

다양한 영속성 레이어 관련 에러가 있다.

`@Repository` 어노테이션의 빈객체가 예외를 반환하는경우에도

<img width="1239" alt="image" src="https://github.com/Tobystudy/toby-spring-study/assets/85499582/f47f0c87-32d0-4a7d-8cb5-10223ed76871">

InvalidDataAccessApiUsageException 으로 래핑해서 전파함!

  
