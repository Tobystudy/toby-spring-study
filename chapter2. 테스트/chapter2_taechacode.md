# 2장 테스트

## 2.1 UserDaoTest 다시 보기
### 2.1.1 테스트의 유용성



### 2.1.2 UserDaoTest의 특징
```
public class UserDaoTest {
    public static void main(String[] args) throws SQLException {
        ApplicationContext context = new GenericXmlApplicationContext("applicationContext.xml");

        UserDao dao = context.getBean("userDao", UserDao.class);

        User user = new User();
        user.setId("user");
        user.setName("강태찬");
        user.setPassword("unmarried");

        dao.add(user);

        System.out.println(user.getId() + " 등록 성공");

        User user2 = dao.get(user.getId());
        System.out.println(user2.getName());
        System.out.println(user2.getPassword());

        System.out.println(user2.getId() + " 조회 성공");    
    }
}
```

- 위 테스트 코드는 자바에서 쉽게 실행 가능한 `main() 메소드`를 이용한다.
- 테스트할 대상인 UserDao의 오브젝트를 가져와 메소드를 호출한다.
- 테스트에 사용할 입력 값(User 오브젝트)을 `직접 코드에서 만들어` 넣어준다.
- 테스트의 결과를 `콘솔`에 출력해준다.
- 각 단계의 작업이 에러 없이 끝나면 콘솔에 성공 메시지로 출력해준다.
<br/>

- 위 테스트 방법에서 가장 돋보이는 것은 main() 메소드를 이용해 쉽게 테스트 수행을 가능하게 했다는 점과 테스트 대상인 UserDao를 직접 호출해서 사용한다는 점이다.
<br/>



#### 웹을 통한 DAO 테스트 방법의 문제점
- 보통 웹 프로그램에서 DAO를 테스트하는 방법은 서비스 계층, MVC 프레젠테이션 계층까지 포함한 모든 입출력 기능을 만들고 테스트용 웹 애플리케이션을 서버에 배치한 뒤, 웹 화면을 띄워보는 것이다.
- 하지만 DAO만을 테스트하기 위해서 이렇게 테스트 환경을 구성하는 것은 너무나도 공수가 많이든다.
- DAO뿐만 아니라 서비스 클래스, 컨트롤러, JSP 뷰 등 모든 레이어의 기능을 다 만들고 나서야 테스트가 가능하다는 점이 큰 문제다.
<br/>

- 테스트가 실패했다면, 어디에서 문제가 발생했는지를 찾아내야 하는 수고도 필요하다.
- 폼을 띄우고 값을 입력하고 저장 버튼을 눌렀는데 에러가 발생했다고 가정해보자. 에러 메시지와 호출 스택만 보고 간단하게 원인을 찾아낼 수 있는가?
- DB 연결이 원인일 수도 있고, DAO 코드가 잘못되었을 수도 있고, JDBC API를 잘못 호출해서일 수도 있다.
- `정작 테스트할 DAO의 문제가 아니라 서버환경에서 웹 화면을 통해 DAO를 테스트하려고 만든 다른 코드 때문에 에러`가 났을 수 있다.
- 사실 테스트하고 싶었던 것은 UserDao였는데 다른 계층의 코드와 컴포넌트, 심지어 서버의 설정 상태까지 모두 테스트에 영향을 줄 수 있기 때문에 이런 방식으로 테스트하는 것은 번거롭다.
<br/>



#### 작은 단위의 테스트
- 테스트하고자 하는 대상이 명확하다면 그 대상에만 집중해서 테스트하는 것이 바람직하다.
- 너무 많은 것을 한꺼번에 몰아서 테스트하면 테스트 수행 과정도 복잡해지고, 오류가 발생했을 때 정확한 원인을 찾기가 힘들어진다.
- 따라서 `테스트는 가능하면 작은 단위로 쪼개서 집중`할 수 있어야 한다.
<br/>

***테스트의 관심이 다르다면 테스트할 대상을 분리하고 집중해서 접근해야 한다.***
<br/><br/>

- UserDaoTest는 한 가지 관심에 집중할 수 있게 작은 단위로 만들어진 테스트다.
- 테스트를 수행하기 위해 웹 인터페이스나, MVC 클래스, 서비스 오브젝트 등이 필요 없고, 서버에 배포할 필요도 없다.
- 이렇게 작은 단위의 코드에 대해 테스트를 수행한 것을 `단위 테스트(Unit test)`라고 한다.
- **충분히 하나의 관심에 집중**해서 **효율적으로 테스트할 만한 범위**의 단위라고 보면 된다.
<br/>

- 단위를 넘어서는 다른 코드들은 신경 쓰지 않고, 참여하지도 않고 테스트가 동작할 수 있으면 좋다.
- UserDao는 서비스, MVC 계층이 참여하고 웹 화면과 서버까지 동원하지 않고도 테스트가 가능했다.
- DAO라는 기능과 DB까지로 단위를 잡고 집중해서 테스트할 수 있었다. -> 그래서 **UserDaoTest를 단위 테스트라고 부를 수 있다.**
<br/>

- 하지만 어떤 개발자는 테스트 중에 DB가 사용되면 단위 테스트가 아니라고 한다.
- 지금까지 UserDaoTest를 수행할 때 매번 USER 테이블의 내용을 비우고 테스트를 진행했다.
- 이렇게 사용할 DB의 상태를 테스트가 관장하고 있다면 이는 단위 테스트라고 해도 된다.
- 다만, DB의 상태가 매번 달라지고, 테스트를 위해 DB를 특정 상태로 만들어줄 수 없다면 그때는 UserDaoTest가 단위 테스트로서 가치가 없어진다.
- 그런 차원에서 `통제할 수 없는 외부의 리소스에 의존하는 테스트는 단위 테스트가 아니라고 보기도 한다.`
<br/>

- 각 단위 기능은 잘 동작하는데 기능들을 묶어놓으면 안 되는 경우가 종종 발생한다.
- 이를 위해 길고 많은 단위가 참여하는 테스트가 언젠가는 필요하다.
- 단위 테스트를 아예 건너뛰고 이런 긴 테스트를 하는 경우도 있다. 수많은 에러가 발생하거나 에러는 안 나지만 기능이 제대로 동작하지 않는 경험을 하게 된다.
- 이때는 문제의 원인을 찾기가 매우 힘들다. 예외가 발생해도 그 이유를 찾는 데 많은 시간이 걸릴 수 있다.
- 예외가 발생하지 않고 정상적으로 동작했는데 막상 결과가 원하는 대로 나오지 않을 수도 있다.
<br/>

***각 단위별로 테스트를 먼저 진행하고 나서 이런 긴 테스트를 하면 어떨까?***
<br/><br/>

- 각 단위별로 테스트를 선행해도 예외가 발생하거나 실패할 수는 있지만 하지 않는 경우보다는 덜할 것이다.
- 단위 테스트를 하는 이유는 `개발자가 설계하고 만든 코드가 원래 의도한 대로 동작하는지를 개발자 스스로 빨리 확인받기 위해서`다.
- 이때 `확인의 대상과 조건이 간단하고 명확할수록 좋다.`
- 그래서 작은 단위로 제한해서 테스트하는 것이 좋다.
<br/>



#### 자동수행 테스트 코드
- UserDaoTest의 한 가지 특징은 `테스트할 데이터가 코드를 통해 제공`되고, `테스트 작업 역시 코드를 통해 자동으로 실행`된다는 점이다.
- 웹 화면에 폼을 띄우속 매번 User의 등록 값을 개발자 스스로 입력하고 버튼을 누르고, 또 조회를 위한 ID 값을 넣고 버튼을 누르는 등의 작업을 반복한다면...
- 간혹 테스트 값 입력에 실수가 있어서 오류가 나면 다시 테스트를 반복해야 하는 번거로움도 있다.
<br/>

- 하지만 UserDaoTest는 자바 클래스의 main() 메소드를 실행하는 가장 간단한 방법만으로 테스트의 전 과정이 자동으로 진행된다.
    - User 오브젝트를 만들어 적절한 값을 넣고, 이미 DB 연결 준비까지 다 되어 있는 UserDao 오브젝트를 스프링 컨테이너에서 가져와서 add() 메소드를 호출하고, 그 키 값으로 get()을 호출하는 것까지 자동으로 진행된다.
- 번거롭게 매번 입력할 필요도 없고, 테스트를 시작하기 위해 서버를 띄우고, 브라우저를 열어야 하는 불편함도 없다.
- 이렇게 하면 테스트를 자주 수행해도 부담이 없다.
<br/>

***테스트는 자동으로 수행되도록 코드로 만들어지는 것이 중요하다.***
<br/><br/>

- 애플리케이션을 구성하는 클래스 안에 테스트 코드를 포함시키는 것보다는 별도로 테스트용 클래스를 만들어서 테스트 코드를 넣는 편이 낫다.
- 처음에는 UserDao 클래스 하나만 존재하여, 그 안에 main() 메소드를 만들어 사용했지만, `클래스를 분리하고 유연한 설계구조로 발전`시키면서 `테스트 코드를 넣을 위치를 결정하기가 애매`하기 때문에 `UserDao라는 별개의 클래스를 만들고 그 안에 테스트 코드`를 넣도록 했다.
<br/>

- 자동으로 수행되는 테스트의 장점은 자주 반복할 수 있다는 것이다.
- 번거로운 작업이 없고 테스트를 빠르게 실행할 수 있기 때문에 언제든 코드를 수정하고 나서 테스트를 해볼 수 있다.
<br/>

- 때로는 단 한 줄의 코드를 건드렸는데 전체 기능에 영향을 주기도 한다.
- 또는 개발을 일단 완료하고 실전에서 운용 중인 상황에서 코드를 수정하려고 한다면 아무리 간단한 수정이라고 하더라도 전체 애플리케이션에 심각한 문제를 일으키지는 않을까 하는 두려움이 앞선다.
- 그럴 때 만들어둔 기능에 대한 테스트가 있다면 수정 후 빠르게 전체 테스트를 수행해서 수정 때문에 다른 기능에 문제가 발생하지는 않는지 재빨리 확인할 수 있다.
